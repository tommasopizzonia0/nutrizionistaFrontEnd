<div class="container-misurazione" [class.dark-mode]="isDarkMode">
  <div class="svg-section">
    <h3>Seleziona la parte del corpo</h3>
    <div class="svg-container">
      <svg version="1.1" viewBox="0 0 604.502 1628.762" width="350" height="auto">

        <!-- Bicipite Destro -->
        <path id="bicipiteDx"
              (click)="onClickSVG('bicipiteDx')"
              [class.evidenziato]="parteCorporeaAttiva === 'bicipiteDx'"
              d="M 159.13867 385.36133 L 80.734375 385.36133 C 81.399172 390.30686 81.452396 394.74638 81.839844 403.01953 C 82.522844 417.60253 78.635594 438.54831 76.183594 446.69531 C 73.617594 455.21831 72.876359 470.44019 68.818359 511.49219 C 62.727359 573.38919 56.463594 554.74877 51.683594 623.00977 C 53.527594 746.00177 52.329484 724.68519 54.021484 744.24219 C 55.000484 755.54019 51.992406 762.57236 51.941406 774.31836 C 51.941406 774.31836 49.598188 778.04803 46.242188 782.45703 C 42.900188 786.84903 34.303031 799.57425 33.957031 800.03125 C 32.651031 801.75425 30.549484 804.19747 29.646484 805.73047 C 28.448484 807.75447 27.856234 813.81912 26.490234 818.20312 C 25.655234 820.88414 23.919109 824.29889 23.287109 827.08789 C 22.201109 831.89589 22.284484 836.01175 21.646484 840.59375 C 21.222484 843.63975 20.093812 847.03195 19.632812 849.50195 C 19.033812 852.71495 20.127953 852.38333 21.751953 853.23633 C 23.413953 854.11733 25.201064 853.66109 27.414062 852.87109 C 31.857063 850.77809 32.795469 846.75939 35.230469 842.65039 L 35.230469 840.52148 C 35.779469 844.59348 35.536672 848.46514 35.513672 852.86914 C 35.404672 874.13214 32.7245 877.49328 32.6875 893.48828 C 32.6685 902.12128 33.681422 909.15384 35.482422 913.46484 C 36.643422 916.24184 40.988297 918.63377 43.779297 913.38477 C 46.337297 908.57877 45.069203 907.48377 46.283203 900.25977 C 47.056203 895.68677 46.900219 891.50533 48.449219 884.11133 C 48.731219 882.76833 48.865859 880.44572 49.130859 879.13672 C 50.854859 870.64572 52.365609 864.05041 53.099609 859.69141 L 54.216797 859.69141 C 56.277797 869.34741 53.820359 882.40319 54.193359 887.24219 C 54.516359 891.42319 54.941078 895.1035 55.080078 899.3125 C 55.170078 902.0415 54.955936 905.70878 55.335938 908.30078 C 55.687936 910.69978 56.307266 913.64672 56.572266 916.38672 C 57.345266 924.40972 66.788578 925.72237 69.017578 915.35938 C 70.103578 910.30838 69.751186 902.46825 70.242188 898.28125 C 73.024186 874.55525 71.034172 878.53394 73.201172 858.83594 C 74.052172 858.50394 74.656875 858.62142 75.546875 858.85742 C 75.546875 858.85742 75.76825 864.44395 76.15625 871.62695 C 76.52125 878.30195 76.612234 868.5417 77.490234 898.5957 C 77.693234 905.4807 77.965344 910.35034 79.902344 913.65234 C 83.371344 917.76434 87.175314 915.14978 88.570312 912.17578 C 91.150313 906.67678 91.662141 897.52903 92.494141 886.95703 C 92.802141 883.06503 93.204781 878.90083 92.425781 868.92383 C 91.937781 862.71483 92.687516 857.48841 92.603516 853.44141 C 93.162516 853.06241 93.163656 853.39563 93.722656 853.01562 C 99.387656 871.49563 94.285959 888.96123 100.00195 896.61523 C 101.38695 897.60923 104.64415 898.03594 106.07812 892.33594 C 109.17915 879.97594 108.99489 846.36844 109.21289 843.64844 C 109.96189 834.31844 109.13278 829.12334 108.92578 821.77734 C 108.69978 813.65234 108.59572 805.28575 107.26172 798.34375 C 106.17872 792.69375 105.59344 785.38639 104.39844 779.52539 C 103.53844 775.30339 102.50883 773.00366 101.92383 768.97266 C 101.68683 762.92566 101.04128 756.2605 102.23828 750.0625 C 109.46128 712.6115 125.14667 680.02015 132.38867 642.70312 C 138.64567 610.45515 133.23017 603.34928 135.82617 585.48828 C 136.42817 581.35028 137.55562 578.50619 138.14062 574.49219 C 140.04563 561.50019 140.5705 550.61623 142.4375 537.61523 C 148.1405 510.22023 159.39045 486.83459 159.18945 454.68359 L 159.26953 454.68359 L 159.13867 385.36133 z"
              style="fill:#99ff55;cursor:pointer" />
        
        <!-- Spalla Destra -->
        <path id="spalle"
              (click)="onClickSVG('spalle')"
              [class.evidenziato]="parteCorporeaAttiva === 'spalle'"
              d="M 158.91016 263.99023 C 153.31243 265.98778 149.73341 266.60654 141.65039 269.95508 C 119.33939 279.19608 103.49848 290.06914 92.021484 313.24414 C 78.865484 339.80414 78.246875 370.78897 80.296875 382.54297 C 80.46726 383.5182 80.611603 384.44801 80.734375 385.36133 L 159.13867 385.36133 L 158.91016 263.99023 z"
              style="fill:#99ff55;cursor:pointer" />

        
        <!-- Gamba Destra -->
        <path id="gambaDx"
              (click)="onClickSVG('gambaDx')"
              [class.evidenziato]="parteCorporeaAttiva === 'gambaDx'"
              d="M 303.01953 742.07812 C 265.42832 741.88233 218.51407 741.5937 159.96484 741.17773 C 159.91251 741.38748 159.86011 741.59459 159.80859 741.80078 L 160.38867 1050.6523 C 162.9251 1068.12 166.56767 1092.1737 171.64844 1121.0059 C 182.01844 1179.8349 164.47209 1203.3644 164.87109 1242.3164 C 165.26809 1281.2704 172.84678 1308.8599 188.80078 1365.2559 C 204.75478 1421.6539 202.75977 1467.5012 202.75977 1475.6172 C 202.75977 1483.7312 202.3608 1491.034 199.9668 1497.123 C 197.5728 1503.206 196.52739 1527.9401 196.77539 1531.2031 C 197.17439 1536.4761 186.80467 1555.1428 184.01367 1560.0098 C 182.03567 1563.4628 176.43523 1572.5863 175.24023 1577.8633 C 174.04323 1583.1403 173.64398 1593.6886 176.83398 1596.9336 C 180.02598 1600.1786 184.01311 1598.5558 184.41211 1597.3398 C 186.40511 1602.2068 194.7832 1601.8027 194.7832 1601.8027 C 194.7832 1601.8027 191.98909 1604.6394 198.37109 1605.8574 C 204.75309 1607.0754 207.5458 1601.3972 208.3418 1602.6152 C 213.1298 1609.8892 223.10867 1608.2025 225.88867 1603.0215 C 225.88867 1603.0215 231.47234 1602.2078 230.27734 1603.4238 C 229.08034 1604.6408 229.47708 1610.7261 237.45508 1613.1641 C 250.61608 1616.4091 256.60045 1607.8876 260.18945 1604.6406 C 263.78045 1601.3976 260.9863 1596.9337 263.7793 1589.2227 C 266.5683 1581.5147 261.38672 1564.8789 261.38672 1558.7969 C 264.97572 1550.2749 263.38086 1527.5509 263.38086 1517.0039 C 263.38086 1506.4519 266.56886 1498.3383 263.38086 1494.2812 C 260.18886 1490.2249 258.92334 1471.3857 255.40234 1451.6797 C 250.61634 1424.8987 259.39119 1371.7494 267.36719 1333.6094 C 275.34519 1295.4694 266.56975 1253.2742 258.59375 1228.1172 C 250.61775 1202.9592 259.39119 1170.5052 267.36719 1146.1602 C 275.34519 1121.8132 282.52372 1022.8139 286.51172 1006.5859 C 290.49972 990.35518 297.66211 932.47852 297.66211 932.47852 C 299.67511 910.36252 298.04485 849.95103 299.79688 835.95703 C 300.05687 833.90003 301.56836 827.31445 301.56836 827.31445 C 302.10118 827.04191 302.58321 827.02957 303.01953 827.25586 L 303.01953 742.07812 z"
              style="fill:#99ff55;cursor:pointer" />
        
        <!-- Gamba Sinistra -->
        <path id="gambaSx"
              (click)="onClickSVG('gambaSx')"
              [class.evidenziato]="parteCorporeaAttiva === 'gambaSx'"
              d="M 303.01953 742.07812 L 303.01953 827.25586 C 310.16369 830.96107 304.99011 898.59783 307.71094 934.04492 C 307.71148 934.04806 315.22442 977.37152 316.81836 983.86328 C 318.41236 990.35628 331.97266 1076.7809 331.97266 1099.5039 C 331.97266 1122.2229 352.71145 1179.4317 352.31445 1198.0977 C 352.05445 1210.2707 341.94336 1258.5527 341.94336 1258.5527 C 333.56836 1291.8197 340.74608 1339.6982 346.33008 1351.8672 C 351.91408 1364.0382 351.11719 1445.5915 351.11719 1454.5215 C 351.11719 1463.4455 343.13811 1495.4984 343.53711 1500.7754 C 343.93811 1506.0484 346.33145 1516.1944 343.93945 1523.8984 C 341.54545 1531.6114 341.94447 1547.8404 346.73047 1557.9844 C 341.94447 1572.5894 343.53819 1586.7898 342.74219 1597.3418 C 341.94419 1607.8888 355.90266 1614.3828 365.47266 1614.3828 C 375.04466 1614.3828 374.24805 1603.832 374.24805 1603.832 L 379.43359 1603.0215 C 379.43359 1603.0215 377.43975 1603.8329 384.21875 1606.6719 C 391.00175 1609.5109 394.19003 1606.6705 396.58203 1603.0215 C 406.15403 1610.3235 409.34597 1600.9924 410.54297 1601.3984 C 411.73797 1601.8044 417.32203 1603.0213 421.70703 1598.1523 C 426.89203 1600.1793 430.08314 1594.4993 432.07812 1587.1973 C 434.07113 1579.8923 424.50197 1557.172 418.91797 1552.707 C 413.33397 1548.244 411.34014 1533.232 409.74414 1527.957 C 408.15014 1522.686 410.94117 1504.424 406.95117 1495.498 C 400.63517 1481.362 406.95169 1461.8251 406.55469 1439.9141 C 406.15569 1418.0031 434.86917 1310.4823 440.45117 1278.0273 C 446.03917 1245.5663 436.46278 1175.3733 433.67578 1166.4473 C 430.88078 1157.5233 436.06558 1111.2665 443.64258 1075.5625 C 445.38419 1067.3567 447.3456 1053.0465 449.24609 1035.5117 L 448.28711 750.23242 C 447.64052 747.21232 447.0304 744.57714 446.51758 742.3418 C 433.16346 742.47563 397.60378 742.57078 303.01953 742.07812 z"
              style="fill:#99ff55;cursor:pointer" />
        
        <!-- Fianchi -->
        <path id="fianchi"
              (click)="onClickSVG('fianchi')"
              [class.evidenziato]="parteCorporeaAttiva === 'fianchi'"
              d="M 176.11914 590.01172 C 176.03154 591.53218 175.96335 592.52193 175.92773 592.88477 C 173.97173 612.65777 170.7025 610.17961 173.3125 629.34961 C 177.2635 658.29661 177.31709 651.94661 168.12109 683.59961 C 167.46209 688.67061 166.11013 695.01884 165.45312 700.08984 C 163.87612 712.25284 162.99887 723.13497 161.42188 735.29297 C 160.90667 737.38778 160.42661 739.32486 159.97656 741.12891 L 446.47266 742.14648 C 446.01371 740.14443 445.63578 738.46921 445.38477 737.13281 C 444.65977 733.27281 444.34266 728.23436 443.59766 724.31836 C 442.83966 720.31136 441.32672 712.59873 440.76172 708.05273 C 440.04672 702.30673 440.28892 699.6995 439.29492 694.6875 C 433.22092 664.0005 432.56492 668.85509 430.54492 659.74609 C 428.45592 650.31209 430.22536 643.8663 431.69336 634.7793 C 432.10736 632.2133 432.09903 627.64481 432.33203 624.50781 C 432.61603 620.66981 433.0633 618.22314 432.7793 614.86914 C 431.1833 596.23014 430.91333 601.37385 429.98633 594.42188 C 429.79989 593.03651 429.62812 591.56247 429.4707 590.01172 L 176.11914 590.01172 z"
              style="fill:#7fff2a;cursor:pointer" />
        
        <!-- Addome -->
        <path id="addome"
              (click)="onClickSVG('addome')"
              [class.evidenziato]="parteCorporeaAttiva === 'addome'"
              d="M 173.94922 498.4043 C 178.83403 528.93454 176.84097 577.48327 176.11914 590.01172 L 429.4707 590.01172 C 426.87552 564.44656 428.15014 518.08848 430.87109 506.375 C 431.76839 502.51458 431.92277 500.22161 431.99023 498.4043 L 173.94922 498.4043 z"
              style="fill:#7fff2a;cursor:pointer" />
        
        <!-- Torace -->
        <path id="torace"
              (click)="onClickSVG('torace')"
              [class.evidenziato]="parteCorporeaAttiva === 'torace'"
              d="M 365.26758 213.59766 C 329.17766 213.65501 287.80293 213.70553 240.37109 213.74414 C 225.00846 228.72427 197.78886 244.63039 184.62891 251.74219 C 170.93999 259.13837 164.06809 262.14963 158.91016 263.99023 L 159.26953 454.68359 L 159.74609 454.68359 C 164.21409 467.74659 168.68048 480.81486 173.14648 493.88086 C 173.43248 495.33708 173.70008 496.84717 173.94922 498.4043 L 431.99023 498.4043 C 432.08096 495.96033 432.01519 494.37647 433.39453 490.99609 C 438.03553 479.63609 443.36973 466.93427 446.17773 455.82227 C 446.55073 455.63127 446.92397 455.44291 447.29297 455.25391 C 447.29416 455.41163 447.29516 455.56928 447.29688 455.72656 L 446.65039 263.54492 C 444.6381 262.80749 442.73309 262.06516 440.95703 261.2832 C 418.02574 251.19286 382.66749 229.99113 365.26758 213.59766 z"
              style="fill:#7fff2a;cursor:pointer" />
        
        <!-- Bicipite Sinistro -->
        <path id="bicipiteSx"
              (click)="onClickSVG('bicipiteSx')"
              [class.evidenziato]="parteCorporeaAttiva === 'bicipiteSx'"
              d="M 524.69336 388.65625 L 447.07031 388.65625 L 447.29688 455.72656 C 447.6332 486.78363 457.85783 509.26177 463.48633 535.34766 C 465.28133 547.73566 466.328 560.88244 468.125 573.27344 C 468.938 578.86944 470.49373 583.71059 471.30273 589.30859 C 470.28273 619.48159 470.12806 616.03356 471.41406 624.97656 C 474.07906 643.54656 469.25036 627.79605 488.56836 697.62305 C 490.94736 706.22505 494.71373 716.26152 496.80273 725.22852 C 497.26173 727.21452 497.93283 728.79189 498.42383 730.71289 C 502.75683 747.56589 505.48283 754.36302 503.42383 768.41602 C 502.34483 775.78102 501.55106 773.70053 499.28906 789.64453 C 497.05006 805.43153 498.00294 790.75222 496.08594 821.82422 C 495.67194 828.32822 494.14834 827.23977 495.73438 847.00977 C 497.04637 863.44377 493.47556 880.97425 498.85156 894.53125 C 500.52256 896.23525 500.33595 896.42423 503.12695 896.61523 C 508.82195 894.24223 506.65116 882.90177 507.91016 873.88477 C 508.71016 868.17977 508.90128 860.95339 510.11328 856.02539 C 510.48628 854.49939 510.20031 853.46559 510.94531 852.30859 C 511.31631 852.49459 511.69145 852.68605 512.06445 852.87305 C 513.96145 863.56005 511.88534 870.08644 511.65234 880.52344 C 511.58234 883.59744 512.15381 884.67242 512.50781 888.48242 C 513.03681 894.24642 512.61509 900.96178 514.37109 907.05078 C 514.55009 907.67678 514.63417 910.89034 516.07617 913.40234 C 518.02917 916.79234 522.88177 916.63311 524.50977 912.91211 C 529.30277 901.94411 525.70937 898.80286 528.85938 869.88086 C 529.19438 866.78386 528.08587 860.14908 530.04688 858.33008 C 530.04688 858.33008 531.36481 858.50569 531.50781 859.67969 C 533.30681 873.77769 532.44555 877.38366 532.81055 886.59766 C 532.91955 889.39166 533.79131 895.78077 533.94531 898.50977 C 534.00331 899.51077 533.83698 909.46427 535.95898 917.57227 C 536.77398 920.67027 539.48263 924.24128 544.14062 922.98828 C 549.21064 921.63128 548.64394 903.47561 549.58594 894.34961 C 551.50194 875.58161 549.67594 887.97767 549.83594 862.51367 C 549.83594 862.51367 551.06759 857.85205 552.18359 863.12305 C 560.73559 903.79805 555.54434 907.84234 561.10938 914.48438 C 563.19137 916.97037 567.15611 917.46961 568.91211 913.97461 C 574.00411 903.84961 570.53833 879.17467 570.11133 873.51367 C 568.41733 851.06667 569.09172 849.12416 569.01172 843.78516 C 572.52172 847.58816 573.17705 852.78031 579.62305 853.82031 C 583.00005 854.54731 584.74791 852.85497 585.00391 851.16797 C 585.18091 849.98497 584.24419 848.70559 584.24219 848.68359 C 583.81519 846.10459 582.26352 843.58231 581.85352 840.94531 C 581.12552 836.26531 582.21417 829.81134 581.20117 827.48438 C 578.74317 821.86237 577.9027 818.87477 577.0957 815.13477 C 576.4387 812.04077 577.0308 809.66333 575.7168 806.86133 C 574.5288 804.33833 572.95377 803.77664 571.25977 801.93164 C 569.76677 800.30964 568.17773 797.3955 566.67773 795.4375 C 549.55773 773.0725 553.82909 770.63262 552.62109 764.64062 C 549.60409 749.77762 550.76545 762.66411 553.56445 696.28711 C 556.69245 621.78211 552.73527 607.22342 551.07227 591.35742 C 550.52027 586.12842 550.60356 583.37197 549.72656 579.29297 C 542.28456 544.71497 541.3612 549.52547 537.6582 512.23047 C 530.4572 439.56047 536.15433 477.31034 525.23633 423.27734 C 523.41036 412.80927 523.80565 398.61869 524.69336 388.65625 z"
              style="fill:#99ff55;cursor:pointer" />
        
        <!-- Spalla Sinistra -->
        <path id="spalle"
              (click)="onClickSVG('spalle')"
              [class.evidenziato]="parteCorporeaAttiva === 'spalle'"
              d="M 446.65039 263.54492 L 447.07031 388.65625 L 524.69336 388.65625 C 524.99236 385.30063 525.34647 382.42431 525.69141 380.33203 C 529.13841 359.35303 523.85128 327.93642 509.98828 305.85742 C 491.46145 276.33436 464.74669 270.17657 446.65039 263.54492 z"
              style="fill:#99ff55;cursor:pointer" />
        
        <!-- Testa -->
        <path id="testa"
              (click)="onClickSVG('testa')"
              [class.evidenziato]="parteCorporeaAttiva === 'testa'"
              d="M 302.64062 14.382812 C 290.4446 14.232919 277.75102 17.703281 265.83008 25.816406 C 244.38208 40.414406 239.08853 66.424156 240.14453 99.660156 C 239.30753 99.447156 238.8653 98.529406 238.0293 98.316406 C 237.3793 98.148406 237.12469 98.182438 235.67969 98.523438 C 230.24369 100.84344 230.52059 106.92792 230.68359 113.29492 C 230.72459 114.93092 230.50756 127.21141 232.60156 134.19141 C 234.95956 142.06041 238.87452 148.43577 245.72852 148.50977 C 247.04552 157.80277 250.25977 171.10156 250.25977 171.10156 C 249.88477 186.43656 250.374 184.55991 250.25 200.87891 C 248.52032 204.77939 245.17347 208.99641 240.82617 213.29688 L 364.66211 213.02344 C 359.5942 208.16344 356.15842 203.74924 355.16406 200.20312 C 354.11206 196.43313 355.81641 168.26562 355.81641 168.26562 C 355.81641 168.26562 358.31253 154.29344 358.51953 149.64844 C 361.71453 148.38044 363.80709 148.65702 365.99609 146.29102 C 374.76309 136.82002 375.54028 127.83367 375.36328 114.38867 C 375.24228 105.34367 373.95339 100.31283 369.65039 98.423828 C 367.21839 98.032828 366.98544 98.640156 365.77344 99.660156 L 365.2168 99.660156 C 366.6378 85.402156 366.57578 68.986547 362.42578 57.060547 C 353.90009 32.565609 329.47188 14.712579 302.64062 14.382812 z"
              style="fill:#99ff55;cursor:pointer" />
      </svg>
    </div>
  </div>
  <!-- src/app/components/misurazione/misurazione.html -->

<div class="form-section">
    <h2>Misurazioni Antropometriche</h2>
    
    <!-- Messaggio di successo -->
    @if (messaggioSuccesso) {
      <div class="alert alert-success">
        <i class="bi bi-check-circle-fill"></i>
        {{ messaggioSuccesso }}
      </div>
    }

    <!-- Messaggio di errore -->
    @if (messaggioErrore) {
      <div class="alert alert-danger">
        <i class="bi bi-exclamation-triangle-fill"></i>
        {{ messaggioErrore }}
      </div>
    }
    
    <form [formGroup]="misurazioniForm">
      @for (mis of misurazioni; track mis.pathId; let i = $index) {
        <div class="misurazione-item">
          <label [for]="'input-' + mis.pathId">{{ mis.nome }}</label>
          <div class="input-group">
            <input
              [id]="'input-' + mis.pathId"
              type="number"
              [formControlName]="mis.pathId"
              (focus)="onFocusInput(mis.pathId)"
              (blur)="onBlurInput()"
              (keydown.enter)="focusNextInput(i, $event)"
              placeholder="0"
              min="0"
              max="300"
              step="0.1"
              [disabled]="salvataggioInCorso"
            />
            <span class="unita">{{ mis.unita }}</span>
          </div>
          @if (misurazioniForm.get(mis.pathId)?.invalid && misurazioniForm.get(mis.pathId)?.touched) {
            <div class="errore">Valore non valido</div>
          }
        </div>
      }

      <div class="pulsanti">
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="salva()" 
          [disabled]="misurazioniForm.invalid || salvataggioInCorso">
          @if (salvataggioInCorso) {
            <span class="spinner-border spinner-border-sm me-2"></span>
            Salvataggio...
          } @else {
            <i class="bi bi-save"></i>
            Salva Misurazioni
          }
        </button>
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="reset()"
          [disabled]="salvataggioInCorso">
          <i class="bi bi-arrow-counterclockwise"></i>
          Reset
        </button>
      </div>
    </form>
  </div>
  
</div>
