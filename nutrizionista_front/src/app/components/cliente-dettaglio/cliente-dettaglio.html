<div class="dettaglio-container"
     [class.dark-mode]="(themeService.isDarkMode$ | async) ?? false"
     [class.sidebar-collapsed]="sidebarService.value">

  <main class="main-content">

    <div class="header">
      <button class="btn btn-secondary" (click)="tornaIndietro()">
        <fa-icon [icon]="faArrowLeft"></fa-icon>
        Torna ai clienti
      </button>

      <button class="btn btn-warning" (click)="modificaCliente()">
        <fa-icon [icon]="faEdit"></fa-icon>
        Modifica
      </button>
    </div>

    @if (cliente) {

      <div class="cliente-hero" [ngClass]="sessoClass">
        <div class="dettaglio-avatar">
          {{ cliente.nome[0] }}{{ cliente.cognome[0] }}
        </div>

        <div class="hero-info">
          <h1 class="dettaglio-nome">
            {{ cliente.nome }} {{ cliente.cognome }}
          </h1>
          <p class="hero-email">
            {{ cliente.email || 'Email non disponibile' }}
          </p>
        </div>

        <span class="badge-large">{{ cliente.sesso }}</span>
      </div>

      <nav class="dettaglio-nav">
        @for (item of navItems; track item.id) {
          <button
            class="nav-item"
            [class.active]="isActiveRoute(item.route)"
            (click)="navigaTo(item.route)">

            <fa-icon [icon]="item.icon"></fa-icon>

            <span class="label">
              {{ item.label }}

              @if (item.route === 'misurazioni' && haNuoveMisurazioni) {
                <span class="notification-dot"></span>
              }
            </span>
          </button>
        }
      </nav>

      @if (vistaCorrente === 'info') {
        <div class="dettaglio-grid">

          <div class="dettaglio-section">
            <h4><fa-icon [icon]="faUser"></fa-icon> Informazioni Anagrafiche</h4>
            <p><strong>Email:</strong> {{ cliente.email || 'Non disponibile' }}</p>
            <p><strong>Telefono:</strong> {{ cliente.telefono || 'Non disponibile' }}</p>
            <p><strong>Data di nascita:</strong> {{ cliente.dataNascita || 'Non disponibile' }}</p>
          </div>

          <div class="dettaglio-section">
            <h4><fa-icon [icon]="faRunning"></fa-icon> Dati Fisici</h4>
            <p><strong>Peso:</strong> {{ cliente.peso ? cliente.peso + ' kg' : 'Non disponibile' }}</p>
            <p><strong>Altezza:</strong> {{ cliente.altezza ? cliente.altezza + ' cm' : 'Non disponibile' }}</p>
          </div>

          <div class="dettaglio-section section-wide">
            <h4><fa-icon [icon]="faHeartbeat"></fa-icon> Informazioni Sanitarie</h4>
            <p>{{ cliente.problematicheSalutari || 'Nessuna' }}</p>
          </div>

        </div>
      }

      @if (vistaCorrente === 'nuova-misurazione') {
        <app-misurazione
          [clienteId]="clienteId"
          [isDarkMode]="(themeService.isDarkMode$ | async) ?? false"
          (misurazioneSalvata)="onMisurazioneSalvata()">
        </app-misurazione>
      }
    }
    @if (vistaCorrente === 'misurazioni') {
      <app-lista-misurazioni
        [clienteId]="clienteId"
        [isDarkMode]="(themeService.isDarkMode$ | async) ?? false">
      </app-lista-misurazioni>
    }

  </main>
</div>
